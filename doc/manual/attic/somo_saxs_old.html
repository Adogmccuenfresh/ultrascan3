<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
   "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta content="text/html;charset=ISO-8859-1" http-equiv="Content-Type">
	<title>SOMO SAXS/SANS Simulation Module</title>
	<link href="mainstyle.css" rel="styleSheet" type="text/css">
</head>
<body>
<table BORDER=0 CELLPADDING=5 >
<tr>
<td><img SRC="ultrascan1.png" BORDER="0" ALT="UltraScan Version"> </td>
<td>
<center>
<h1>
<i>Manual</i></h1></center>
</td>
</tr>
</table>

<hr>
<center>
<h2>
SOMO - SAXS/SANS Simulation Module:</h2>
<p>
<img SRC="somo-SAXS_SANS.png" ALT="SOMO SAXS Simulation Screen">
</center>
<p>
Small-Angle X-ray or Neutron Scattering (SAXS or SANS) <i>I(q)</i> vs. <i>q</i> curves, and pairwise distance distribution
curves <i>P(r)</i> vs. <i>r</i>, can be generated by this  module from either a PDB file or a bead model. The module is still under development, but several features are already (March 2012) available.<p>
The module window is accessed from the <b>US-SOMO</b> main window by pressing the <b><i>SAXS/SANS Functions</i></b> button. If either a PDB or a bead model file are loaded in the <b>US-SOMO</b> main window, it will be automatically exported to the <b>SAXS/SANS module</b>, and listed in the <i>PDB Filename</i> (alternatively, <i>Bead Model Filename</i>) field. If no files were selected in the main <b>US-SOMO</b> window, this field will be empty.<p>
In order to properly compute the  <i>I(q)</i> vs. <i>q</i> and <i>P(r)</i> vs. <i>r</i> curve, the module utilizes the  <a href=
"somo-2.png">atom definition</a> (default: <i>somo.atom</i>), <a href="somo-hybrid.png">hybridization</a> (default: <i>somo.hybrid</i>) and <a href="somo-saxs_coeff1.png">SAXS coefficients</a> (default: <I>somo.saxs_atoms</i>) tables. Different tables can be selected by pressing the <b><i>Load Atom Definition File</i></b>, <b><i>Load Hybridization File</i></b>, and <b><i>Load SAXS Coefficients File</i></b> buttons. See the <a href="somo.html">main help</a> for further explanations on the content and use of these tables.<p>
The <b>SAXS/SANS module</b> panel is divided in two sections, <b><i>SAXS/SANS I(q) Plotting Functions:</i></b> and <b><i>P(r) vs. r Plotting Functions:</i></b>, which can operate indipendently, each one with its graphics window. <p>
<hr>
<center>

<p>
<img SRC="somo-SAXS_SANS_Iq_panel.png" ALT="SOMO SAXS I(q) Simulation Panel">
</center>
<p>

<b><i>SAXS/SANS Plotting Functions:</i></b>
The first box in this section provides the user with a choice between several methods for the computation of the <i>I(q)</i> vs. <i>q</i> curves for either SAXS or SANS (via mutually exclusive checkboxes).<p>
For SAXS, the choice is between:
<ul>
<li>
<b><i>Full</i></b>. Full Debye method, utilizing the following equations:<p>

<img SRC="Debye_eq1.png" ALT="Debye for SAXS">
<p>
with<p>
<img SRC="Debye_eq2.png" ALT="Debye for SAXS">
<p>
where <i>c<sup>(i)</sup></i>, <i>a<sub>k</sub><sup>(i)</sup></i> and <i>b<sub>k</sub><sup>(i)</sup></i> are the X-ray scattering atomic coefficients of non-hydrogen atom <i>i</i>, taken from the <a href="somo-saxs_coeff1.png">SAXS coefficients</a> table, <i>count<sup>(i)</sup><sub>hydrogen</sub></i> is the number of hydrogens attached to atom <i>i</i>, deduced from the  <a href="somo-2.png">atom definition</a> table, <i>c<sup>(hydrogen)</sup></i>, <i>a<sub>k</sub><sup>(hydrogen)</sup></i> and <i>b<sub>k</sub><sup>(hydrogen)</sup></i> are the X-ray scattering atomic coefficients of hydrogen atoms, <i>v<sup>(i)</sup><sub>excluded</sub></i> is the excluded volume of the atomic group <i>i</i> (non-hydrogen atom + attached hydrogen(s)), taken from the  <a href="somo-2.png">atom definition</a> table, &rho; is the solvent electron density, as entered in the <a href=somo_saxs_options.html>SAXS/SANS Options</a> panel, <i>q<sub>j</sub></i> is the scattering vector at which the computation is performed, and <i>r<sub>i,k</sub></i> is the distance between the centers of atoms <i>i</i> and <i>k</i>.

<li>
<b><i>H3</i></b>. Hybrid Debye method. The computations.....<p>

<li>
<b><i>Fast</i></b>. Fast Debye method.<p>

<li>
<b><i>FoXS</i></b>. This will externally call a pre-compiled version of the method described in Schneidman-Duhovny, Hammel and Sali, "FoXS: a web server for rapid computation and fitting of SAXS profiles", Nucl. Acids Res. 38:W540-W544, 2010. Presently, no options can be set for FoXS, which is then unable to perform parametric fitting to an experimental curve.<p>

<li>
<b><i>Crysol</i></b>. This will externally call the popular program Crysol (Svergun, Barberato, and Koch. J. Appl. Cryst. 28:768-773, 1995), whose main options can be set in the <a href=somo_saxs_options.html> SAXS/SANS Options submenu</a>. Currently (March 2012) the parametric fit to an experimental curve capability of Crysol has not yet been implemented within <b>US-SOMO</b>.<p>
</ul>

For SANS no <i>I(q)</i> vs. <i>q</i> computation methods have yet (March 2012) been implemented. The choice will be between:
<ul>
<li>
<b><i>Full</i></b>. Full Debye method.<p>

<li>
<b><i>H3</i></b>. Hybrid Debye method.<p>

<li>
<b><i>Fast</i></b>. Fast Debye method. <p>

<li>
<b><i>Crysol</i></b>. This will externally call Cryson (Svergun, Richard, Koch, Sayers, Kuprin and Zaccai. Protein hydration in solution: experimental observation by X-ray and neutron scattering. Proc. Natl. Acad. Sci. USA 95:2267-2272, 1998).<p>
</ul>
<hr>
<center>

<p>
<img SRC="somo-SAXS_SANS_Iq_panel1.png" ALT="SOMO SAXS I(q) Simulation Panel part">
</center>
<p>
When a method is selected, the right field of the <i>File suffix:</i> two fields will show an automatic extension: db for Full Debye, h3a for H3 hybrid Debye, fd for Fast Debye, fx for FoXS, and cr_h##_g##_hs#_## for Crysol. For the latter, h## indicates the number of harmonics, g## the order of the Fibonacci grid, and hs#_## the contrast of the hydration shell. An user defined file suffix can also be added in the left field, and the content of these two fields will be appended to the PDB (or bead model) root filename. All <i>I(q)</i> vs. <i>q</i> generated curves will have the extension ".ssaxs" (or ".ssans").<p>
Before starting an <i>I(q)</i> vs. <i>q</i> computation, an experimental curve might be loaded by pressing the <b><i>Load SAXS Curve</i></b> button (the label will switch to  <b><i>Load SANS Curve</i></b> if a SANS method is selected). This will open up a panel listing previously utilized directories where the appropriate file might be found:  
<center>
<p>
<img SRC="somo-SAXS_SANS_Previous_Directories.png" ALT="SOMO SAXS I(q) Previous Directories">
</center>
<p>
<center>
<p>
<img SRC="somo-SAXS_SANS_File_types.png" ALT="SOMO SAXS I(q) File tipes">
</center>
<p>
Once a file has been selected (see above for a list of compatible file types), the curve will be displayed in the top-right interactive graphic window:
<center>
<p>
<img SRC="somo-SAXS_SANS_SAXS_curve.png" ALT="SOMO SAXS I(q) Expt. SAXS curve example">
</center>
<p>
Pressing the <b><i>Legend</i></b> button will toggle on/off the displayed curve(s) filenames. Portions of the graphs can be zoomed in by selecting them with the mouse while pressing the central button:
<center>
<p>
<img SRC="somo-SAXS_SANS_SAXS_curve1.png" ALT="SOMO SAXS I(q) Expt. SAXS curve zoom example">
</center>
<p>
The top horizontal and right vertical scroll bars allow the visualization of other portions of the graph at the actual zoom level. Right-clicking with the mouse on the graph will restore the full scaling of the graph. Right-clicking on the graph frame will instead open an interactive panel for setting overall graph properties (not shown). Other plotting properties, such as the <i>q</i> units (&#8491; or nm), can be set in the <a href=somo_saxs_options_misc.html> SAS Miscellaneous Options</a> submenu.<p>
Previously computed csv-style <i>I(q)</i> vs. <i>q</i> files, such as those generated using the <a href="somo_batch.html">US-SOMO Batch Mode</a>, can also be uploaded in the graphic window. In this case, a new window will open listing all the individual curves present in the csv file, plus all other files already uploaded into the graphic window, as described in this <a href="somo_saxs_load_csv.html">help file</a>.

After the appropriate selection, pressing "OK" will update the graphic window, and at the same time also the progress window in the bottom-left corner of the panel:
<center>
<p>
<img SRC="somo-SAXS_SANS_Plotted2.png" ALT="SOMO SAXS I(q) Expt. SAXS CSV file average SD plotted">
</center>
<p>
<center>
<p>
<img SRC="somo-SAXS_SANS_Plotted_progress window.png" ALT="SOMO SAXS I(q) Expt. SAXS CSV file progress window">
</center>
<p>

The progress window reports several parameters of the scaling operation, like fitting range, scaling factor, &chi;<sup>2</sup>, degrees of freedom (df), normalized &chi; (nchi=<span style="white-space: nowrap; font-size:larger"> &radic;</span> <span style="text-decoration:overline;">&nbsp;&chi;<sup><span style="white-space: nowrap; font-size:smaller">2</span></sup>&nbsp; / (df - 1) &nbsp;</span> ), the average standard deviation of the target curve (sdf), and the product nchi*sdf. The scaling operation is performed weighting each point in the target curve by its associated error. Since data derived from modern SAS detectors can have very small associated errors, the resulting nchi can assume relatively large values even for quite good fits. The product nchi*sdf should give a better estimate of the goodness of the fit. This can be seen by comparing the different ways the residuals of the scaling operation can be represented in a pop-up windows that appears at the end of the process:



<center>
<p>
<img SRC="somo-SAXS_SANS_Iq_panel1.png" ALT="SOMO SAXS I(q) Simulation Panel part">
</center>
<p>
Getting back to the  <b><i>SAXS/SANS I(q) Plotting Functions:</i></b> panel, pressing the  <b><i>Load Plotted</i></b> button will re-open the <i>Load CSV style SAXS results</i> window, listing all data currently shown on the graphic window, on which further operations can be performed (see <a href="somo_saxs_load_csv.html">here</a>).<br>
More operations with multiple <i>I(q)</i> vs. <i>q</i> datasets, such as NNLS fitting or best dataset fitting to a target curve can be performed within the <a href="somo_saxs_load_csv.html"><i>Load CSV style SAXS results</i></a>  module.<br> 
Pressing the <b><i>Set Grid</i></b> button will open up a small window allowing to select, if multiple curves are present, which one is to be used to set the grid for computing an <i>I(q)</i> vs. <i>q</i> curve:
<center>
<p>
<img SRC="somo-SAXS_SANS_Set_Grid.png" ALT="SOMO SAXS I(q) Expt. SAXS CSV file average SD plotted">
</center>
<p>
Pressing the <b><i>Clear SAXS (SANS) Curve</i></b> button will sequentially remove all loaded curve(s) from the graphics window.<br>
The <b><i>Load GNOM</i></b> button allow loading the content of a GNOM-generated file (see <a href="http://www.embl-hamburg.de/biosaxs/manual_gnom.html">http://www.embl-hamburg.de/biosaxs/manual_gnom.html</a>). This will load graphs in both the <i>I(q)</i> vs. <i>q</i> and <i>P(r)</i> vs. <i>r</i> windows.

<p>
<p>
<p>
<p>
<hr>
<center>

<p>
<img SRC="somo-SAXS_SANS_Pr_panel.png" ALT="SOMO SAXS P(r) Simulation  Panel">
</center>
<p>
The <i>P(r)</i> vs. <i>r</i> function can be computed in either "<b>Raw</b>", "<b>SAXS</b>", or "<b>SANS</b>" modes, as
selected using the checboxes provided. The equation used is:
<p>
<i>P(r)</i> = &Sigma;<sub><i>i</i></sub> &Sigma;<sub><i>j</i></sub> [((<i>b<sub>i</sub></i> - <i>b<sub>0i</sub></i>) * (<i>b<sub>j</sub></i> - <i>b<sub>0j</sub></i>) / <i>< (b - b<sub>0</sub>) ><sup>2</sup></i> * &delta;(<i>r</i> - <i>r<sub>ij</sub></i>)] 
<p>
with, for SAXS, <i>b<sub>0i</sub></i> = 10 * (<i>r<sub>i</sub></i> / <i>r<sub>wat</sub></i>)<sup>3</sup>
<p>
where the <i>b<sub>i</sub></i> and <i>b<sub>j</sub></i> are: 1- set to "1" for the "<b>Raw</b>" computations; 
2- are the number of electrons of the <i>i</i> and <i>j</i> atomic groups for the <b>SAXS</b> computations; and 3- are the neutron
scattering lengths of the <i>i</i> and <i>j</i> atomic groups at the set D<sub>2</sub>O fraction <i>Y</i> for the <b>SANS</b>
computations. For SAXS, 10 is the number of electrons in a water molecule, <i>r<sub>i</sub></i> is the radius of the <i>i<sup>th</sup></i> atom (from the <i>somo.atom</i> table) and <i>r<sub>wat</sub></i> is the radius of a bulk water molecule (as set in the <i>SAXS options</i>). The full implementation for SANS in solution is still pending (March 2012). The Kronecker's <i>delta</i> &delta;(<i>r</i> - <i>r<sub>ij</sub></i>) is applied to the distances <i>r<sub>ij</sub></i> between the atom's <i>i</i> and <i>j</i> centers for every bin <i>r</i>. The resolution is controlled by the <b>Bin size (Angstroms):</b> field (default: <b>1 A</b>). For calculations carried on the original PDB structure, the number of electrons are tabulated in the <a href="somo-hybrid.png">hybridization table</a>). For bead models, only the <b>Raw</b> option is
currently (March 2010) active. In a future release, when generating a bead model the number of electrons of the atoms "assigned"
to the bead will be summed up and written in the bead model file (9<sup>th</sup> column), and could then be used in
the <i>P(r)</i> vs. <i>r</i> computations. Similarly, for the <b>SANS</b> computations directly on a PDB structure, the neutron
scattering lengths are computed at the set D<sub>2</sub>O fraction <i>Y</i> (<i>b(Y)<sub>i</sub></i> and <i>b(Y)<sub>j</sub></i>, 
computed as explained <a href=somo_saxs_options.html> here</a>), and the only the <b>Raw</b> option is currently (March 2010)
active for bead models. In a future release, when generating a bead model the <i>b(0)</i> values and the number of exchangeable H 
of the atoms "assigned" to each bead will be summed up and written in the bead model file as the 10<sup>th</sup> and 11<sup>th</sup>
columns, respectively. The computation of the <i>b(Y)<sub>i</sub></i> and <i>b(Y)<sub>j</sub></i> at the set D<sub>2</sub>O fraction
<i>Y</i> could then be carried out for the evaluation of the SANS <i>P(r)</i> vs. <i>r</i> distribution for a bead model.<p> 

By pressing the <b><i>Compute P(r) distribution</i></b> button a 3-columns file is created, containing the <i>r</i>,
the non-normalized <i>P(r)</i>, and the normalized <i>P(r)</i> values, respectively. The <b>Normalize</b> clickbox will
affect which kind is then shown in the graphic window on the right side, which will automatically rescale upon adding a new graph.
The files will be saved in the /somo/SAXS/ directory and will have the extension <i>sprr_r</i> for the "Raw" setting, <i>.sprr_x</i>
for the SAXS setting, and <i>.sprr_n</i> for the SANS setting. In addition, a suffix containing the bin size used (<i>e.g.</i>,
<i>b1</i> for bin size = 1) will be added at the end of the PDB or bead model filename. For the SANS-type files, a suffix
recalling the the D<sub>2</sub>O fraction will be also added (<i>e.g.</i>, <i>D05</i> for D<sub>2</sub>O fraction = 0.5). If
a file with the same filename already exist, a prompt will appear asking if it should be overwritten or not. In the latter case,
the <i>P(r)</i> vs. <i>r</i> distribution will be computed and shown in the graphic window, but not saved to a new file.
The graphic window will show every new <i>P(r)</i> vs. <i>r</i> curve in a different color, without erasing curves already
present (we plan to add a side bar with a correspondence between the colors and the files). A previously-generated, or 
experimentally-derived <i>P(r)</i> vs. <i>r</i> curve can be uploaded in the graphic window by pressing the <b><i>Load P(r) 
Distribution</i></b> button, and the graphic window can be cleared by pressing the <b><i>Clear P(r) Distribution</i></b> button.
Progress in the operations is reported in the advancement bar on the side of the  <b><i>Compute P(r) distribution</i></b> button,
and in the text window below the buttons. <b><i>Stop</i></b> will halt the current operation, and the option panel containing
the settings controlling the operations, such as the D<sub>2</sub>O fraction (see <a href=somo_saxs_options.html> here</a>),
can be directly accessed by pressing the <b><i>Open Options Panel</i></b> button.<p>


<p>


<p>
<hr>
<font face="helvetica" size="-1">
www contact: <a href="mailto:demeler@biochem.uthscsa.edu">Borries Demeler</a>
</font>
<p>
<font face="helvetica" size="-1">
This document is part of the <i><b>UltraScan</b></i> Software Documentation
distribution. <br><a href=copyright.html>Copyright &copy; notice</a>.<br><br> The latest version of this document can always be found at:
</font>
<p>
<font face="helvetica" size="-1">
<a href="http://www.ultrascan.uthscsa.edu">http://www.ultrascan.uthscsa.edu</a>
</font>
<p>
<font face="helvetica" size="-1">
Last modified on February 17, 2012
</font>
</body>
</html>
